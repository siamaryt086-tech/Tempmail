<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Temp Mail - mail.tm API</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; text-align: center; padding: 20px; }
  #email { font-size: 20px; font-weight: bold; margin: 10px; }
  button { padding: 10px 15px; font-size: 16px; cursor: pointer; }
  table { margin: 20px auto; border-collapse: collapse; background: white; }
  table, th, td { border: 1px solid #ccc; padding: 10px; }
  th { background: #eee; }
</style>
</head>
<body>

<h1>ðŸ“§ My Temp Mail</h1>
<div>
  <button onclick="createEmail()">Generate Email</button>
</div>
<p id="email">Click "Generate Email" to start</p>

<h2>Inbox</h2>
<table id="inbox">
  <tr><th>From</th><th>Subject</th><th>Date</th></tr>
</table>

<script>
let token = '';
let userId = '';
let emailAddr = '';
let login = '';
let domain = '';

async function createEmail() {
  // Get available domains
  let domainsRes = await fetch('https://api.mail.tm/domains');
  let domains = await domainsRes.json();
  let randomDomain = domains['hydra:member'][Math.floor(Math.random() * domains['hydra:member'].length)].domain;

  // Generate random email + password
  login = Math.random().toString(36).substring(2,10);
  domain = randomDomain;
  emailAddr = `${login}@${domain}`;
  let password = Math.random().toString(36).substring(2,12);

  // Create account
  await fetch('https://api.mail.tm/accounts', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ address: emailAddr, password: password })
  });

  // Get token
  let tokenRes = await fetch('https://api.mail.tm/token', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ address: emailAddr, password: password })
  });
  let tokenData = await tokenRes.json();
  token = tokenData.token;

  document.getElementById('email').innerText = `Your Email: ${emailAddr}`;
  fetchInbox();
  setInterval(fetchInbox, 5000); // refresh inbox every 5 sec
}

async function fetchInbox() {
  if (!token) return;
  let inboxRes = await fetch('https://api.mail.tm/messages', {
    headers: { 'Authorization': `Bearer ${token}` }
  });
  let inboxData = await inboxRes.json();
  
  let table = document.getElementById('inbox');
  table.innerHTML = '<tr><th>From</th><th>Subject</th><th>Date</th></tr>';
  inboxData['hydra:member'].forEach(msg => {
    let row = `<tr>
      <td>${msg.from.address}</td>
      <td>${msg.subject}</td>
      <td>${new Date(msg.createdAt).toLocaleString()}</td>
    </tr>`;
    table.innerHTML += row;
  });
}
</script>

</body>
</html>
